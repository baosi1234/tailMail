啊舒服撒发撒风
说的分手大方水电费水电费
I want read the log like "tail -f" *NIXwhen I kill the program I can know how many bytes I have already read,and I can use the seekwhen the program start again,will continue to read the log line by line depend by seek data in step 2I want get the bytes when I use bufio.NewScanner as a line reader to read a line
I want read the log like "tail -f" *NIXwhen I kill the program I can know how many bytes I have already read,and I can use the seekwhen the program start again,will continue to read the log line by line depend by seek data in step 2I want get the bytes when I use bufio.NewScanner as a line reader to read a line
I want read the log like "tail -f" *NIXwhen I kill the program I can know how many bytes I have already read,and I can use the seekwhen the program start again,will continue to read the log line by line depend by seek data in step 2I want get the bytes when I use bufio.NewScanner as a line reader to read a line
I want read the log like "tail -f" *NIXwhen I kill the program I can know how many bytes I have already read,and I can use the seekwhen the program start again,will continue to read the log line by line depend by seek data in step 2I want get the bytes when I use bufio.NewScanner as a line reader to read a line

eg:

import ...
func main() {
    f, err := os.Open("111.txt") 
    if err != nil {          
        log.Fatal(err)
    }
    f.Seek(0,os.SEEK_SET)
    scan := bufio.NewScanner(f)
    for scan.Scan() {
        log.Printf(scan.Text())
        //what I want is how many bytes at this time when I read a line
    }//This is a program for read line
}

thx! ==================================update========================================== @twotwotwo this is close to what I want,but I want change the io.Reader to the io.ReaderAt, and it is what I want,I write a demo use the io.Reader:`

import (
   "os"
   "log"
   "io"
)
type Reader struct {
    reader io.Reader
    count  int
}
func (r *Reader) Read(b []byte) (int, error) {
    n, err := r.reader.Read(b)
    r.count += n
    return n, err
}
func (r *Reader) Count() int {
    return r.count
}
func NewReader(r io.Reader) *Reader {
    return &Reader{reader: r}
}

func ReadLine(r *Reader) (ln int,line []byte,err error) {
    line = make([]byte,0,4096)
    for {
        b := make([]byte,1)
        n,er := r.Read(b)
        if er == io.EOF {
            err = er
            break
        }
        if n > 0{
            c := b[0]
            if c == '\n' {
                break
            }
            line = append(line, c)
        }
        if er != nil{
            err = er
        }
    }

    ln = r.Count()
    return ln,line,err
}

func main() {
    f, err := os.Open("111.txt")
    if err != nil {          
        log.Fatal(err)
    }
    fi,_:=os.Stat("111.txt")
    log.Printf("the file have %v bytes",fi.Size())
    co := NewReader(f)
    for {
        count,line,er := ReadLine(co)
        if er == io.EOF {
            break
        }
        log.Printf("now read the line :%v",string(line))
        log.Printf("in all we have read %v bytes",count)


    }

}`
this Program can tell me how many bytes I have already read,but cannt read start from anywhere where I want,so I think that if we use io.ReaderAt must can do it. thanks again!

go
shareedit
edited Nov 20 '14 at 8:04
asked Nov 19 '14 at 12:46

unicorns
62
add a comment
2 Answers
active oldest votes
up vote
0
down vote
You could consider another approach based on os.File.

See ActiveState/tail, which monitor the state of a file, and uses os.File#Seek() to resume tailing a file from within a certain point.

See tail.go.

shareedit
edited Nov 19 '14 at 15:14
answered Nov 19 '14 at 13:03

VonC
551k15014971595
  	 	
thx,I have been saw it before I asked at there,but it can't solve my problem. – unicorns Nov 20 '14 at 8:07
add a comment
up vote
-1
down vote
Consider composition.

We know that bufio.NewScanner is interacting with its input through the io.Reader interface. So we may wrap an io.Reader with something else that counts how many bytes have been read so far.

package main

import (
    "bufio"
    "bytes"
    "io"
    "log"
)

type ReadCounter struct {
    io.Reader
    BytesRead int
}

func (r *ReadCounter) Read(p []byte) (int, error) {
    n, err := r.Reader.Read(p)
    r.BytesRead += n
    return n, err
}

func main() {
    b := &ReadCounter{Reader: bytes.NewBufferString("hello\nworld\testing\n")}
    scan := bufio.NewScanner(b)
    for scan.Scan() {
        log.Println(scan.Text())
        log.Println("Read", b.BytesRead, "bytes so far")
    }
}
But we'll note that bufio.NewScanner is buffered, so we can see that it reads its input in chunks. So for your purposes, this might not be as useful as you want.

An alternative is to take the content of scan.Text() and count up the lengths. You can compensate for its removal of newline bytes in your internal count.

shareedit
answered Nov 19 '14 at 21:52

dyoo
7,97711231
1	 	
Facebook (specifically the Parse team) wrote a counting.Reader and counting.Writer. It sounds like asker would really like to know start position + bytes written (which wouldn't include any partial line read at exit). – twotwotwo Nov 20 '14 at 0:14 
  	 	
@dyoo thanks for ur answers, it's looks like the facebook's project told by twotwotwo . and I have been updated the question. – unicorns Nov 20 '14 at 8:39
add a comment
Your Answer

Links Images Styling/Headers Lists Blockquotes Code HTML advanced help »

 
Post Your Answer
Not the answer you're looking for?	Browse other questions tagged go or ask your own question.

asked

1 year ago

viewed

116 times

active

1 year ago

Featured on Meta
Careers Unificintegration: Jobs on Stack Overflow
Hot Meta Posts
3 How often do people who get private messages from moderators actually notice …
39 Is Stack Overflow open source?
31 Edits which only change the edit summary should be accepted during grace period
matheducators.stackexchange.com
What does maths teach you that logic does not?
– LePressentiment
2 answers logic

Want a java job?
Senior Backend Engineer
Metrigo Gmbh (Zalando SE)
Hamburg, Germany / relocation
javanetty
Senior Software Engineer
ThoughtWorks
Beijing, China
javaruby
82 People Chatting

Lounge<C++>
3 hours ago - Elyse
Puppy: 3 hours agonick: 3 hours agoElyse: 3 hours agosehe: 3 hours agoAlex M.: 3 hours agouser3886129: 3 hours agotristan: 4 hours ago
JavaScript
3 hours ago - phenomnomnominal
phenomnomnominal: 3 hours agocrl: 3 hours agoSterling Archer: 3 hours agoKarelG: 4 hours agoAsh: 4 hours agoFlorian Margaine: 4 hours agoMeredith: 4 hours ago
Related

153 How to read/write from/to file?
34 How to reduce compiled file size?
54 golang: read text file into string array (and write)
32 How to assign string to bytes array
49 How to check whether a file or directory denoted by a path exists in golang?
38 How can I efficiently download a large file using Go?
9 How to read utf16 text file to string in golang?
1 How to read the first four bytes of a file, using Go?
58 how do I SET the GOPATH environment variable on Ubuntu? What file must I edit?
4 How to read a text file line-by-line in Go when some lines are long enough to cause “bufio.Scanner: token too long” errors?
Hot Network Questions

Supervisor "Jokingly" Slapped my bum
Is the name of this chemical 3-oxopropanoic acid?
What is the smallest positive base 10 integer that can be printed by a program shorter (in characters) than itself?
Is there a word or term used to categorize words that are unnecessary to conform with grammar rules and don't add to the meaning of a sentence?
Why did this stormtrooper choose a melee weapon?
Why would a website serve different versions over HTTP and HTTPS?
What are some math books written in dialogue or story form, e.g., a teacher explaining to a student?
Why is sound sparingly used on websites?
Make a Unicorn interpreter
How can I temporarily change text colour?
Why did the Resistance expect aid from the Republic's fleet to begin with?
How to set the default program to open a certain file type in a certain folder?
Which chapter of the One Punch Man webcomic should I start on after seeing the anime?
How can 64 = 65?
In which situations is it better to consider a loan instead of paying cash?
What links are there between Dune and Force Awakens?
What's wrong with this line in a baking recipe book?
The usage of the definite article
If I need to use a piece of memory throughout the lifespan of my program, is it really necessary to free it right before program termination?
Is this the same droid in two scenes from the Force Awakens?
Why doesn't this fairly simple "if" work?
Which quantity is greater?
Difference between beau and bel
+!! operator in an if statement
question feed
tour help blog chat data legal privacy policy work here advertising info mobile contact us feedback
TECHNOLOGY	LIFE / ARTS	CULTURE / RECREATION	SCIENCE	OTHER
Stack Overflow
Server Fault
Super User
Web Applications
Ask Ubuntu
Webmasters
Game Development
TeX - LaTeX
Programmers
Unix & Linux
Ask Different (Apple)
WordPress Development
Geographic Information Systems
Electrical Engineering
Android Enthusiasts
Information Security
Database Administrators
Drupal Answers
SharePoint
User Experience
Mathematica
Salesforce
ExpressionEngine® Answers
more (13)
Photography
Science Fiction & Fantasy
Graphic Design
Movies & TV
Seasoned Advice (cooking)
Home Improvement
Personal Finance & Money
Academia
more (9)
English Language & Usage
Skeptics
Mi Yodeya (Judaism)
Travel
Christianity
Arqade (gaming)
Bicycles
Role-playing Games
more (21)
Mathematics
Cross Validated (stats)
Theoretical Computer Science
Physics
MathOverflow
Chemistry
Biology
more (5)
Stack Apps
Meta Stack Exchange
Area 51
Stack Overflow Careers
site design / logo © 2015 Stack Exchange Inc; user contributions licensed under cc by-sa 3.0 with attribution required
rev 2015.12.28.3134